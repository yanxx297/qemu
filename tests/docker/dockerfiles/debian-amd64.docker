#
# Docker x86_64 target
#
# This docker target builds on the debian Stretch base image. Further
# libraries which are not widely available are installed by hand.
#
FROM qemu:debian9
MAINTAINER Philippe Mathieu-Daud√© <f4bug@amsat.org>

RUN DEBIAN_FRONTEND=noninteractive eatmydata \
    apt-get build-dep -yy qemu

RUN DEBIAN_FRONTEND=noninteractive eatmydata \
    apt-get install -y --no-install-recommends \
        libbz2-dev \
        liblzo2-dev \
        librdmacm-dev \
        libsnappy-dev \
        libvte-dev

# virgl
RUN DEBIAN_FRONTEND=noninteractive eatmydata \
    apt-get install -y --no-install-recommends \
        libegl1-mesa-dev \
        libepoxy-dev \
        libgbm-dev
RUN git clone git://anongit.freedesktop.org/virglrenderer /usr/src/virglrenderer
RUN cd /usr/src/virglrenderer && ./autogen.sh && ./configure --with-glx --disable-tests && make install
